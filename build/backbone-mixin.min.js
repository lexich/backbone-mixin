var MixinBackbone;MixinBackbone=function(a){return MixinBackbone.version="0.3.2",MixinBackbone=function(b){return b.extend({constructor:function(a){var c;return this._$_options=a,null!=(c=b.prototype.constructor)&&c.apply(this,arguments),delete this._$_options},setElement:function(){return null==this._$_p&&(this._$_p={currentView:null,diViews:{},removeFlag:!1,varbindUIElements:null,var_bindings:null}),b.prototype.setElement.apply(this,arguments),"function"==typeof this.scope&&this.scope(this._$_options),null!=this.className&&this.$el.addClass(this.className),this.reloadTemplate(),this.bindUIElements(),this.bindRegions(),this.bindUIEpoxy()},remove:function(){var a,c,d;if(this._$_p.removeFlag===!0)return this;this._$_p.removeFlag=!0,b.prototype.remove.apply(this,arguments),this.unbindRegions(),this.unbindUIElements(),d=this._$_p.diViews;for(a in d)c=d[a],c.remove();return this._$_p.diViews={}},delegateEvents:function(a){var c;return a||(a=_.result(this,"events")),null!=this._$_p.varbindUIElements&&null!=a&&(a=_.reduce(a,function(a){return function(b,c,d){var e,f,g,h,i;if(f=d.match(/@ui\.[^ ,]+/g),null!=f)for(h=0,i=f.length;i>h;h++)e=f[h],null!=/@ui\.([^ ,]+)/.exec(e)&&(g=a._$_p.varbindUIElements[RegExp.$1],d=d.replace(e,g));return b[d]=c,b}}(this),{})),null!=(c=b.prototype.delegateEvents)?c.call(this,a):void 0},listenToValue:function(a,b,c){var d;return d=/change:(.+)/.exec(b)?RegExp.$1:b,this.listenTo(a,"change:"+d,c),setTimeout(function(b){return function(){return c.call(b,a,a.get(d),{})}}(this),0)},_diViewsKeys:function(){return _.keys(this._$_p.diViews)},_diViewsValues:function(){return _.values(this._$_p.diViews)},setNeedRerenderView:function(a){return a._$_oneShow=null},setNeedRerender:function(){return this.setNeedRerenderView(this)},_setCurrentView:function(a){return this._$_p.currentView=a},show:function(a,b,c){var d,e;return null==b&&(b={}),null==a?void("function"==typeof c&&c()):(d=this.getViewDI(a,b),d===this._$_p.currentView?("function"==typeof c&&c(),d):(e=function(a){return function(){return a._setCurrentView(null),a!==d&&a._setCurrentView(d),a.$el.append(d.$el),d.showCurrent(c),d}}(this),null!=this._$_p.currentView&&this!==this._$_p.currentView?this.close(this._$_p.currentView,e):e(),d))},showCurrent:function(a){var b,c,d,e,f,g,h;if(this.trigger("onBeforeShow"),"function"==typeof this.onBeforeShow&&this.onBeforeShow(),null==this._$_oneShow&&(this._$_oneShow=!0,this.trigger("render"),this.render()),b=_.after(3,function(){return function(){return"function"==typeof a?a():void 0}}(this)),e=_.result(this,"regions"))for(d=_.keys(e),f=_.after(_.size(d),b),g=0,h=d.length;h>g;g++)c=d[g],this.r[c].showCurrent(f);else b();return null!=this._$_p.currentView&&this._$_p.currentView!==this?this._$_p.currentView.showCurrent(b):b(),this.showAnimation(function(a){return function(){return a.trigger("onShow"),"function"==typeof a.onShow&&a.onShow(),b()}}(this))},closeCurrent:function(a){var b,c,d,e,f,g,h;if(this.trigger("onBeforeClose"),"function"==typeof this.onBeforeClose&&this.onBeforeClose(),b=_.after(3,function(){return function(){return"function"==typeof a?a():void 0}}(this)),e=_.result(this,"regions"))for(d=_.keys(e),f=_.after(_.size(d),b),g=0,h=d.length;h>g;g++)c=d[g],this.r[c].closeCurrent(f);else b();return null!=this._$_p.currentView&&this._$_p.currentView!==this?this._$_p.currentView.closeCurrent(b):b(),this.closeAnimation(function(a){return function(){return a.trigger("onClose"),"function"==typeof a.onClose&&a.onClose(),b()}}(this))},close:function(a,b){var c;return null==a?void("function"==typeof b&&b()):(c=_.after(2,function(){return function(){return"function"==typeof b?b():void 0}}(this)),null!=this._$_p.currentView&&this._$_p.currentView!==a?this.close(this._$_p.currentView,c):c(),this._setCurrentView(null),a.closeCurrent(c),a)},showAnimation:function(a){return this.showViewAnimation(this,a)},closeAnimation:function(a){return this.closeViewAnimation(this,a)},showViewAnimation:function(a,b){return null==a?void("function"==typeof b&&b()):null!=a.showAnimation&&a!==this?a.showAnimation(b):(a.$el.show(),"function"==typeof b?b():void 0)},closeViewAnimation:function(a,b){return null==a?void("function"==typeof b&&b()):null!=a.closeAnimation&&a!==this?a.closeAnimation(b):(a.$el.hide(),"function"==typeof b?b():void 0)},getViewDI:function(a,b){var c,d,e,f,g,h,i;return null==b&&(b={}),null!=a.cid?(c=a.constructor,e=a.cid,this._$_p.diViews[e]=a):"function"==typeof a?(c=a,e=c._$_di||(c._$_di=_.uniqueId("_$_di"))):(c=a.type,c._$_di||(c._$_di=_.uniqueId("_$_di")),e=a.key),d=this._$_p.diViews[e],g=!!(null!=d&&null!=(i=d._$_p)?i.removeFlag:void 0),(null==d||g)&&(this._$_p.diViews[e]=h=new c(b),null==h._$_p&&(h._$_p={removeFlag:!1},f=h.remove,h.remove=function(){return f.apply(h,arguments),h._$_p.removeFlag=!0})),this._$_p.diViews[e]},reloadTemplate:function(){var a,b,c;if(c=null,b=null,null!=this.template){if(a=$(this.template),!a.length)return;c=a.html()}return null!=this.templateData&&(b=_.result(this,"templateData"),null!=this.templateFunc||(this.templateFunc=_.template)),null!=this.templateFunc?this.$el.html(this.templateFunc(c,b)):null!=c?this.$el.html(c):void 0},unbindRegions:function(){var a,b,c,d;if(this.regions){c=this.regions,d=[];for(a in c)b=c[a],"__oldmode__"!==a&&(this.r[a].remove(),delete this.r[a],d.push(this.regions.__oldmode__?delete this[a]:void 0));return d}},bindRegions:function(){var b,c,d,e,f,g,h,i,j,k;if(null==this.r&&(this.r={}),this.regions){h=/@ui\.([^ ]+)/,d=_.isBoolean(this.regions.__oldmode__)&&this.regions.__oldmode__,j=this.regions,k=[];for(e in j)i=j[e],"__oldmode__"!==e&&(_.isObject(i)?(c=_.isString(i.el)?this.$el.find(i.el):c=i.el,b=i.view):(c=null!=h.exec(i)&&null!=this.ui[RegExp.$1]?this.ui[RegExp.$1]:this.$el.find(i),b=MixinBackbone(a.View)),null!=this.r[e]?this.r[e].setElement(c):(g={el:c},_.isFunction(i.scope)?(f=i.scope.call(this),_.extend(g,f)):_.isObject(i.scope)&&_.extend(g,i.scope),this.r[e]=new b(g)),k.push(d&&null==this[e]?this[e]=this.r[e]:void 0));return k}},bindUIElements:function(){var a,b,c,d;if(null!=this.ui){this.unbindUIElements(),this._$_p.varbindUIElements=_.extend({},this.ui),this.ui={},c=this._$_p.varbindUIElements,d=[];for(a in c)b=c[a],d.push(this.ui[a]=this.$el.find(b));return d}},unbindUIElements:function(){return null!=this._$_p.varbindUIElements?(this.ui=this._$_p.varbindUIElements,this._$_p.varbindUIElements=null):void 0},bindUIEpoxy:function(){var a;if(this.bindings)return this.unbindUIEpoxy(),this._$_p.var_bindings=this.bindings,a=/@ui\.([^ ]+)/,this.bindings=_.reduce(this._$_p.var_bindings,function(b){return function(c,d,e){var f,g;return null!=a.exec(e)?(g=b._$_p.varbindUIElements[RegExp.$1],f=e.replace(a,g),c[f]=d):c[e]=d,c}}(this),{})},unbindUIEpoxy:function(){return null!=this._$_p.var_bindings?(this.bindings=this._$_p.var_bindings,this._$_p.var_bindings=null):void 0}})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(["backbone"],function(a){return MixinBackbone(a)}):window.MixinBackbone=MixinBackbone(Backbone);